<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #333;
            color: white;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        video {
            width: 100%;
            display: block;
        }

        .video-info {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f5f5f5;
        }

        .recommendations {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            flex: 1;
            max-width: 230px;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>{{ data.Name }}</h1>
    </header>
    <div class="container">
        <video controls id="videoContainer" data-id="{{ data.id }}">
            <source src='/servevideo/{{ data.Path }}' type="video/mp4">
            Ваш браузер не поддерживает воспроизведение видео.
        </video>
        <div class="video-info">
            <button id="likeButton">Лайк {{ data.Reactions.Likes }}</button>
            <button id="dislikeButton">Дизлайк {{ data.Reactions.Dislikes }}</button>
            <h2>{{ data.Name }}</h2> 
            <p>{{ data.ViewCount }} Просмотров</p>
            <p>Описание: {{ data.Description }}</p>
        </div>
        <div class="recommendations">
            {% for video in data['recommended_videos'] %}
            {% if video != None %}
            <a href="/video/{{ video['Path'] }}" class="video-link">
                <div class="video-card">
                    <img src="/image/{{ video['ImagePath'] }}" width="230" height="150" alt="Thumbnail">
                    <h3>{{ video['Name'] }}</h3>
                </div>
            </a>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const likeButton = document.getElementById('likeButton');
    const dislikeButton = document.getElementById('dislikeButton');
    const videoId = document.getElementById('videoContainer').getAttribute('data-id'); // Получение id видео

    likeButton.addEventListener('click', function() {
        sendReaction(videoId, 1); // 1 означает лайк
    });

    dislikeButton.addEventListener('click', function() {
        sendReaction(videoId, 0); // 0 означает дизлайк
    });

    function sendReaction(videoId, isLike) {
        var xhr = new XMLHttpRequest();
        var method = 'POST';
        var url = '/react/video';

        xhr.open(method, url, true);
        xhr.setRequestHeader('Content-Type', 'application/json');

        xhr.onload = function() {
            if (xhr.status === 200) {
                console.log('Реакция отправлена успешно');
            } else {
                console.error('Произошла ошибка при отправке реакции.');
            }
        };

        xhr.onerror = function() {
            console.error('Произошла ошибка при выполнении запроса.');
        };

        xhr.send(JSON.stringify({ VideoId: videoId, IsLike: isLike }));
    }
});
</script>
</html>